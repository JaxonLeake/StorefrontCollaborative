<HTML lang="JavaScript">
<HEAD>
    <TITLE> Storefront Collaborative </TITLE>
</HEAD>
<BODY>
<SCRIPT LANGUAGE="JavaScript">

    /**
     * Main System
     */

    // Global Variables
    let page;
    let items = [{Name:"ItemName1", Description:"ItemDescription1", Images:["Images\\1.png"], Price:10, Stock:3},
        {Name:"ItemName2", Description:"ItemDescription2", Images:["Images\\2.jpg"], Price:15, Stock:7}];

    /**
     * Item Catalogue
     */

    // Global Variables
    let canvas;
    let context;
    let SearchboxContent = "";

    // Configuration
    let searchBoxStart, searchBoxEnd, maxSearchBoxSize;
    let cursorBlink = 500;



    let selected = null;
    let lastClickTime = Date.now();

    /**
     * Main function
     */
    function bigDog() {
        RunSignIn();
    }

    function RunItemCatalogue() {
        document.body.innerHTML = "";
        page = "Item Catalogue"
        canvas = document.createElement('canvas');
        canvas.id = 'canvas';
        document.body.appendChild(canvas);
        context = canvas.getContext('2d');
        // Add event listener for `click` events.
        canvas.addEventListener('click', function(event) {
            let x = event.pageX,
                y = event.pageY;
            console.log("CLICK(" + x + ", " + y + ")");
            lastClickTime = Date.now();
            if(x > searchBoxStart && x < searchBoxEnd && y > 10 && y < 50) {
                console.log("Search Box");
                selected = "Search Box";
            } else if((x > canvas.width-250 && x < canvas.width-20) &&
                ((y > 10 && y < 50) || (selected === "Account Box" && y > 10 && y < 170))) {
                console.log("Account Box");
                selected = "Account Box";
                if(y > 50 && y < 90) {
                    console.log("Opens Account Settings Page");
                    RunAccountSettings();
                } else if(y > 90 && y < 130) {
                    console.log("Opens Placeholder Page");
                    RunUnknown();
                } else if(y > 130 && y < 170) {
                    console.log("Opens Sign In Page");
                    RunSignIn();
                }
            } else {
                console.log("null");
                selected = null;
            }
        }, false);
        canvas.addEventListener("keydown", function(event) {
            if(event.key === "Backspace" && SearchboxContent.length > 0) {
                SearchboxContent = SearchboxContent.slice(0, SearchboxContent.length-1);
            } else {
                if(event.key.length === 1) {
                    SearchboxContent += event.key;
                }
            }
        }, false);

        TickItemCatalogue();
    }

    function RunAccountSettings() {
        document.body.innerHTML = "";
        page = "Account Settings";
        document.write("Account Settings Page Placeholder");
    }

    function RunUnknown() {
        document.body.innerHTML = "";
        page = "Placeholder";
        document.write("Placeholder Page Placeholder");
    }

    function RunSignIn() {
        document.body.innerHTML = "";
        page = "Sign In";
        document.write("Sign In Page Placeholder");
        setTimeout(() => { RunItemCatalogue(); }, 1000);
    }

    function TickItemCatalogue() {

        // Containers
        canvas.width = window.innerWidth-15;
        canvas.height = window.innerHeight-20;

        drawSquare({x:0,y:0}, {x: canvas.width, y: canvas.height}, {hue: 0, sat: 0, lum: 100}, 1, -1); // Background
        drawSquare({x:0,y:0}, {x: canvas.width, y: canvas.height}, {hue: 0, sat: 0, lum: 0}, 1, 5); // Background
        drawSquare({x:0,y:0}, {x: canvas.width, y: 60}, {hue: 0, sat: 0, lum: 80}, 1, -1); // Top Banner
        drawSquare({x:0,y:0}, {x: canvas.width, y: 60}, {hue: 0, sat: 0, lum: 50}, 1, 5);
        drawText("Item Catalogue", 30, {hue: 0, sat: 0, lum: 30}, 20, 40);
        searchBoxStart = 350;
        searchBoxEnd = canvas.width - 300;
        maxSearchBoxSize = 500;

        // Search Box

        if(searchBoxEnd - searchBoxStart > maxSearchBoxSize) { searchBoxEnd = searchBoxStart + maxSearchBoxSize; } // Max search box size
        if(searchBoxStart + 150 < searchBoxEnd) { // Minimum search box size
            drawSquare({x:searchBoxStart,y:10}, {x: searchBoxEnd, y: 50}, {hue: 0, sat: 0, lum: 90}, 1, -1);
            drawSquare({x:searchBoxStart,y:10}, {x: searchBoxEnd, y: 50}, {hue: 0, sat: 0, lum: 60}, 1, 5);
            // Dynamic text and blinker
            if(SearchboxContent === "") {
                drawText("Search . . .", 30, {hue: 0, sat: 0, lum: 60}, searchBoxStart+20, 40);
                if(selected === "Search Box" && Math.round((Date.now())/cursorBlink) % 2 === 0) {
                    console.log("Search Box Anim");
                    drawText("|", 30, {hue: 0, sat: 0, lum: 60}, searchBoxStart+15, 38);
                }
            } else {
                let text = SearchboxContent;
                if(selected === "Search Box" && Math.round((Date.now())/cursorBlink) % 2 === 0) {
                    text += "|";
                }
                drawText(text, 30, {hue: 0, sat: 0, lum: 60}, searchBoxStart+20, 40);
            }
        }

        // Account Box

        drawSquare({x:canvas.width-250,y:10}, {x: canvas.width-20, y: 50}, {hue: 0, sat: 0, lum: 70}, 1, -1);
        drawSquare({x:canvas.width-250,y:10}, {x: canvas.width-20, y: 50}, {hue: 0, sat: 0, lum: 50}, 1, 5);
        drawText("Account Name", 30, {hue: 0, sat: 0, lum: 30}, canvas.width-230, 40);
        if(selected === "Account Box") {
            drawSquare({x:canvas.width-250,y:50}, {x: canvas.width-20, y: 90}, {hue: 0, sat: 0, lum: 85}, 1, -1);
            drawSquare({x:canvas.width-250,y:50}, {x: canvas.width-20, y: 90}, {hue: 0, sat: 0, lum: 50}, 1, 5);
            drawText("Account Settings", 30, {hue: 0, sat: 0, lum: 30}, canvas.width-230, 80);
            drawSquare({x:canvas.width-250,y:90}, {x: canvas.width-20, y: 130}, {hue: 0, sat: 0, lum: 85}, 1, -1);
            drawSquare({x:canvas.width-250,y:90}, {x: canvas.width-20, y: 130}, {hue: 0, sat: 0, lum: 50}, 1, 5);
            drawText("Placeholder", 30, {hue: 0, sat: 0, lum: 30}, canvas.width-230, 120);
            drawSquare({x:canvas.width-250,y:130}, {x: canvas.width-20, y: 170}, {hue: 0, sat: 0, lum: 85}, 1, -1);
            drawSquare({x:canvas.width-250,y:130}, {x: canvas.width-20, y: 170}, {hue: 0, sat: 0, lum: 50}, 1, 5);
            drawText("Log Out", 30, {hue: 0, sat: 0, lum: 30}, canvas.width-230, 160);
        }

        if(page === "Item Catalogue") {
            setTimeout(() => { TickItemCatalogue(); }, 1); // refresh the Item Catalogue Page constantly
        }
    }

    /**
     * Draw text to screen where x and y represent the bottom right corner of text
     * @param text the text to write
     * @param size size in pixels
     * @param {{hue, sat, lum}} colour the points hsl colour
     * @param x distance that left side of text is from left side of screen
     * @param y distance that top of text is from top of screen
     */
    function drawText(text, size, colour, x, y) {
        context.beginPath();
        context.font = size + 'px serif';
        context.fillStyle = 'hsl('+ colour.hue + ',' + colour.sat + '%,' + colour.lum + '%)';
        context.globalAlpha = 1;
        context.fillText(text, x, y);
        context.closePath();
    }

    /**
     * @param {Object} v1, {Object} v2 - the two 2d vertexes that describe the square
     * @param {{hue, sat, lum}} colour the points hsl colour
     * @param {number} opacity 0-1
     * @param {number} strokeSize width of the outline, 0 or less to fill
     * @returns void
     */
    function drawSquare(v1, v2, colour, opacity, strokeSize) {
        drawPolygon([{x: v1.x, y: v1.y}, {x: v1.x, y: v2.y}, {x: v2.x, y: v2.y}, {x: v2.x, y: v1.y}], colour, opacity, strokeSize);
    }

    /**
     * Draws a polygon with vertices at the given screen positions
     * @param {[{x, y}]} vertices Array of vertices that represent each of the 2d vertexes defining the polygon
     * @param {{hue, sat, lum}} colour the points hsl colour
     * @param {number} opacity 0-1
     * @param {number} strokeSize width of the outline, 0 or less to fill
     * @returns void
     */
    function drawPolygon(vertices, colour, opacity, strokeSize) {
        //console.log(vertices);
        context.beginPath();
        context.fillStyle = 'hsl('+ colour.hue + ',' + colour.sat + '%,' + colour.lum + '%)';
        context.globalAlpha = opacity;
        context.moveTo(vertices[0].x, vertices[0].y);
        for(let i = 1; i<vertices.length; i++) {
            context.lineTo(vertices[i].x, vertices[i].y);
        }
        context.closePath();
        if(strokeSize <= 0) {
            context.fill();
        } else {
            context.lineWidth = 1;
            context.stroke();
        }
    }

    bigDog(); // Call the main function to start the program
</SCRIPT>
</BODY>
</HTML>